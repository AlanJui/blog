---
layout: post
title: Java 注入相依的妙用
date: '2014-05-20T07:24:00.000+08:00'
author: 居正中
tags:
- 科技
- Java
modified_time: '2014-05-20T22:15:08.249+08:00'
thumbnail: http://4.bp.blogspot.com/-30H5WDc1vKE/U3n8885RPJI/AAAAAAAAcuo/6fpssQGG88U/s72-c/2014-5-19+%E4%B8%8B%E5%8D%88+08-44-41.png
blogger_id: tag:blogger.com,1999:blog-1068034375721560223.post-3904207618578602831
blogger_orig_url: http://blog.ccc99.tw/2014/05/java.html
---

<div><br />軟體專家告訴哦棉，好的程式設計，要寫成「耦合鬆綁（decouple）」，這樣，每個程式單元，才能隨時利用，任意組合。<br /><br />But................. &nbsp; How?!<br /><br />這裡，有一個例子。假設，我們需要開發一個「腳踏車出租管理系統」，供腳踏車店做出租服務。<br /><br />第一個想開發的功能是：「在螢幕列出店裡所有的腳踏車」。<br /><br />對於這個功能，我們可以這樣做。<br /><br />先開發一個： Bike（腳踏車）的 Entity 類別，其程式碼如下。</div><br /><div style="line-height: 1.2em;"><b style="line-height: 1.2em;"><span style="color: purple;">Bike</span></b><b style="line-height: 1.2em;"><span style="color: purple;">&nbsp;類別&nbsp;</span></b><br /><script src="https://gist.github.com/anonymous/f84cc1abef1d8e87ac9c.js"></script><br /></div><div>再開發一個：RentABike （租台腳踏車）的類別，用來管理腳踏車出租店的租借業務。在此類別先實作了 2 個方法（method），（1）getBikes：取得店裡所有的腳踏車；（2）getBike ：依「序號」取得某一台特定的腳踏車，其程式碼如下。<br /><br /></div><div style="line-height: 1.2em;"><b><span style="color: purple;">RentABike 類別&nbsp;</span></b><br /><script src="https://gist.github.com/AlanJui/7ef9440fd3d4db19a32a.js"></script><br /></div><div>為了在螢幕上顯示店裡所有的腳踏車，我們又多開發了一個：「CommandLineView」類別，其程式碼如下。<br /><br /><b style="line-height: 1.2em;"><span style="color: purple;">CommandLineView 類別</span></b></div><div style="line-height: 1.2em;"><script src="https://gist.github.com/AlanJui/951df5e7c1063c2da837.js"></script><br /></div><div><div>一般的寫法，我們會很自然地在 CommandLineView 這個類別裡，先用 RentABike 類別建立一個 rentABike 物件。<br /><br />然後，再利用 rentABike 物件，呼叫方法 － getBikes() ，取出店裡所有的腳踏車。接著在 CommandLineView 類別中，利用迴圈，在螢幕列示出所有的腳踏車。<br /><br /></div><div style="line-height: 1.2em;"></div>以上的作法，既簡單，又直覺。但....... 它沒有達到「耦合鬆綁」所要求的程式架構之美！因 CommandLineView 類別與 RentABike 類別，十指緊扣，關係密切啊！     ^^"<br /><br />那該怎麼辦咧？！<br /><br />《<a href="http://goo.gl/w6SW4m" target="_blank">Spring 程式高手秘笈</a>》這書，在 Page 1 ~ 9 處，教人如何利用 Interface ，進行「相依注入（Dependency Injection）」，讓 CommandLineView 類別，呼叫 getBikes() 方法的這檔事 ，不是寫死在 CommandLineView 類別中，而是由另一個類別，在 Run Time 時期，負責相依關係的相注入，使 CommandLineView 物件，能呼叫 &nbsp;getBikes() 這方法！<br /><br />這麼神奇的事，是如何做到的？<br /><ol><li>原先 RentABike 類別，能提供其它類別使用的 method ，將它當成是 service ，全包進一個名為 RentABike 的 Interface 中。</li><li>另新增一個「service 類別」 (&nbsp;ArrayListRentABike&nbsp;) ，須實作 (implements) 上一個 RentABike Interface 。</li><li>要使用「service 類別」，呼叫其中 method 的這種類別，稱作：「client 類別」， 以此例子而言，就是 CommandLineView 類別，它在類別中，須有一個 property ，用來指向「 service 類別」所產生的物件。</li><li>建立一個類別，負責在 Run Time 時期，執行「相依注入」的工作，這種作法，一般被稱作為 assembler 或 container 機制。在這個例子中，由 RentABikeAssembler 類別擔綱。</li></ol><br />此相依注入的作法，可用以下的「類別圖」，來說明各個類別之間的相互關係。</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-30H5WDc1vKE/U3n8885RPJI/AAAAAAAAcuo/6fpssQGG88U/s1600/2014-5-19+%E4%B8%8B%E5%8D%88+08-44-41.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-30H5WDc1vKE/U3n8885RPJI/AAAAAAAAcuo/6fpssQGG88U/s1600/2014-5-19+%E4%B8%8B%E5%8D%88+08-44-41.png" /></a></div><br />最後，各類別的程式碼，分述如下。<br /><div class="separator" style="clear: both; text-align: center;"></div><br /><div style="line-height: 1.2em;"><b><span style="color: purple;">將 RentABike 類別改成 Interface</span></b><br /><br /><script src="https://gist.github.com/anonymous/4f1c39112eb2a368958a.js"></script><br /></div><div style="line-height: 1.2em;"><b><span style="color: purple;">提供 method 的「Service 類別」：ArrayListRentABike.java</span></b><br /><br /><script src="https://gist.github.com/anonymous/e4a21eff57a2a412f7cb.js"></script><br /></div><div style="line-height: 1.2em;"><b><span style="color: purple;">使用 method 的「Client 類別」：CommandLineView.java</span></b><br /><script src="https://gist.github.com/anonymous/16029a478a565d7aeaab.js"></script><br /></div><div style="line-height: 1.8em;"><br /><b style="line-height: 1.2em;"><span style="color: purple;">注入相依的 Assembler 類別：RentABikeAssembler.java</span></b></div><div style="line-height: 1.2em;"><br /><script src="https://gist.github.com/anonymous/8fa548e45e26643488f4.js"></script><br /><div style="-webkit-text-stroke-width: 0px; color: black; font-family: 'LiHei Pro'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 1.2em; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;"></div><br /><div style="-webkit-text-stroke-width: 0px; color: black; font-family: 'LiHei Pro'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 1.8em; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;"><div style="margin: 0px;">Run Time 時期，由 RentABikeAssembler 類別，負責「注入相依關係」這檔事。</div><div style="margin: 0px;"><br /></div><div style="margin: 0px;">首先，建立一個「Client 物件」：&nbsp;<span style="line-height: 1.8em;">CommandLineView 物件；然後，建立一個「Service 物件」：</span><span style="line-height: 1.8em;">ArrayListRentABike。</span></div><div style="margin: 0px;"><span style="line-height: 1.8em;"><br /></span></div><div style="margin: 0px;"><span style="line-height: 1.8em;">接著令「Client 物件」－</span><span style="line-height: 1.8em;">&nbsp;</span><span style="line-height: 1.8em;">CommandLineView&nbsp;</span><span style="line-height: 1.8em;">的 property 指向「Service 件件」 －&nbsp;</span><span style="line-height: 1.8em;">ArrayListRentABike。</span><span style="line-height: 1.8em;">最後， CommandLineView 這個「Client 物件」，可以使用&nbsp;</span><span style="line-height: 1.8em;">「Service 物件」－</span><span style="line-height: 1.8em;">&nbsp;</span><span style="line-height: 1.8em;">ArrayListRentABike ，</span><span style="line-height: 1.8em;">提供的 getBikes() 方法，取出店裡所有的腳踏車，丟給類別內的方法處理，顯示在螢幕上 。</span></div><div style="margin: 0px;"><br /></div></div></div><div>透過以上「相依注入」的作法，可達成「耦合鬆綁（decouple）」的目標。軟體開發中所使用的各個類別，就能任意組合，隨時依自己的需要來變化及使用。<br /><br /><br />程式碼下載處：&nbsp;<a href="https://github.com/AlanJui/BPANDSVC" target="_blank">https://github.com/AlanJui/BPANDSVC</a></div>
